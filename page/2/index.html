<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>THAT-WHAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="THAT-WHAT">
<meta property="og:url" content="https://jarryliu-p.github.io/page/2/index.html">
<meta property="og:site_name" content="THAT-WHAT">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="THAT-WHAT">
  
    <link rel="alternate" href="/atom.xml" title="THAT-WHAT" type="application/atom+xml">
  
  
    <link rel="icon" href="css/images/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">THAT-WHAT</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-前端常用代码示例-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/05/前端常用代码示例-1/" class="article-date">
  <time datetime="2019-05-05T07:36:15.000Z" itemprop="datePublished">2019-05-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/05/前端常用代码示例-1/">前端常用代码示例-1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>Anagrams of string(变更字母顺序构成新字符串-字谜)<br>使用递归。对于给定字符串中的每个字母，为字母创建字谜。使用map（）将字母与每部分字谜组合，然后使用reduce（）将所有字谜组合到一个数组中，最基本情况是字符串长度等于2或1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">anagrams = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (str.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [str];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (str.length === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [str, str[<span class="number">1</span>] + str[<span class="number">0</span>]]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [...str].reduce(<span class="function">(<span class="params">pre, letter, i</span>) =&gt;</span></span><br><span class="line">        pre.concat(anagrams(str.slice(<span class="number">0</span>, i) + str.slice(i + <span class="number">1</span>)).map(<span class="function"><span class="params">value</span> =&gt;</span> letter + value)), []);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">anagrams(<span class="string">'abcd'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组平均数<br>使用reduce（）将每个值添加到累加器，初始值为0，总和除以数组长度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">average = <span class="function"><span class="params">arr</span> =&gt;</span> arr.reduce(<span class="function">(<span class="params">pre, val</span>) =&gt;</span> pre + val, <span class="number">0</span>) / arr.length;</span><br><span class="line"></span><br><span class="line">average([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>大写每个单词的首字母<br>使使用replace（）匹配每个单词的第一个字符，并使用toUpperCase（）来将其大写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">capitalizeEveryWord = <span class="function"><span class="params">str</span> =&gt;</span> str.replace(<span class="regexp">/\b[a-z]/g</span>, char =&gt; char.toUpperCase());</span><br><span class="line"></span><br><span class="line">capitalizeEveryWord(<span class="string">'hello world !'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>首字母大写<br>使用slice（0,1）和toUpperCase（）大写第一个字母，slice（1）获取字符串的其余部分。省略lowerRest参数以保持字符串的其余部分不变，或将其设置为true以转换为小写。（注意：这和上一个示例不是同一件事情）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">capitalize = <span class="function">(<span class="params">str, lowerRest = <span class="literal">false</span></span>) =&gt;</span></span><br><span class="line">    str.slice(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + (lowerRest ? str.slice(<span class="number">1</span>).toLowerCase() : str.slice(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">capitalize(<span class="string">'jarryLiu'</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串反转</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reverseString = <span class="function"><span class="params">str</span> =&gt;</span> [...str].reverse().join(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">reverseString(<span class="string">'hello'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查回文<br>将字符串toLowerCase，并使用replace从中删除非字母的字符。然后拆分为单独字符，reverse，join（’’），与原始的非反转字符串进行比较</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">palindrome = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> s = str.toLowerCase().replace(<span class="regexp">/[^a-z0-9]/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> s === [...s].reverse().join(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">palindrome(<span class="string">'eye'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算数组中值的出现次数<br>使用reduce迭代增加计数器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">countOccurrences = <span class="function">(<span class="params">arr, target</span>) =&gt;</span> </span><br><span class="line">    arr.reduce(<span class="function">(<span class="params">count, val</span>) =&gt;</span> val === target ? count + <span class="number">1</span> : count, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">countOccurrences([<span class="string">'a'</span>,<span class="string">'c'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'d'</span>],<span class="string">'c'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Curry（柯里化）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curry = <span class="function">(<span class="params">fn, arity = fn.length, ...args</span>) =&gt;</span></span><br><span class="line">    arity &lt;= args.length ? fn(...args) : curry.bind(<span class="literal">null</span>, fn, arity, ...args);</span><br><span class="line"></span><br><span class="line">curry(<span class="built_in">Math</span>.max, <span class="number">3</span>)(<span class="number">3</span>)(<span class="number">7</span>)(<span class="number">90</span>);</span><br><span class="line">curry(<span class="built_in">Math</span>.pow)(<span class="number">2</span>)(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Deep flatten array(拍平数组)<br>递归，使用reduce来获取所有不是数组的元素,思考一下为什么不用 push</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拍平二维数组</span></span><br><span class="line">flatten = <span class="function"><span class="params">arr</span> =&gt;</span> arr.reduce(<span class="function">(<span class="params">a, v</span>) =&gt;</span> a.concat(v), []);</span><br><span class="line"><span class="comment">//递归拍平多维嵌套数组</span></span><br><span class="line">deepFlatten = <span class="function"><span class="params">arr</span> =&gt;</span></span><br><span class="line">    arr.reduce(<span class="function">(<span class="params">pre, val</span>) =&gt;</span></span><br><span class="line">        pre.concat(<span class="built_in">Array</span>.isArray(val) ? deepFlatten(val) : val), []);</span><br><span class="line"></span><br><span class="line">deepFlatten([<span class="number">8</span>,<span class="number">5</span>,[<span class="number">4</span>,[<span class="number">6</span>,[<span class="number">7</span>]]],<span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组比较差异<br>从b创建一个Set，然后在a上使用Array.filter,思考使用Set的好处</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">different = <span class="function">(<span class="params">arr1, arr2, include = <span class="literal">false</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> _arr2 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr2);</span><br><span class="line">    <span class="keyword">return</span> arr1.filter(<span class="function"><span class="params">ele</span> =&gt;</span> include ? _arr2.has(ele) : !_arr2.has(ele));</span><br><span class="line">&#125;</span><br><span class="line">similarity = <span class="function">(<span class="params">arr1, arr2</span>) =&gt;</span> arr1.filter(<span class="function"><span class="params">ele</span> =&gt;</span> arr2.includes(ele));</span><br><span class="line"></span><br><span class="line">different([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>], <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算两点之间欧几里得距离<br>Math.hypot</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">distance = <span class="function">(<span class="params">x0, y0, x1, y1</span>) =&gt;</span> <span class="built_in">Math</span>.hypot(x1 - x0, y1 - y0);</span><br><span class="line"></span><br><span class="line">distance(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>转义正则表达式<br>转义正则表达式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">escapeRegExp = <span class="function"><span class="params">str</span> =&gt;</span> str.replace(<span class="regexp">/[.*+?^$&#123;&#125;()|[\]\\]/g</span>, <span class="string">'\\$&amp;'</span>);</span><br><span class="line"></span><br><span class="line">escapeRegExp(<span class="string">'(test)'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>阶乘<br>使用递归。如果n小于或等于1，则返回1。否则返回n和n – 1的阶乘的乘积</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">factorial = <span class="function"><span class="params">n</span> =&gt;</span> n &lt;= <span class="number">1</span> ? <span class="number">1</span> : n * factorial(n - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">factorial(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>斐波那契数组生成<br>创建一个特定长度的空数组，初始化前两个值(m,n)。使用Array.reduce向数组中添加值，后面的一个数等于前面两个数相加之和（前两个除外）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fibonacci = <span class="function">(<span class="params">l, m, n</span>) =&gt;</span> <span class="built_in">Array</span>(l).fill(<span class="number">0</span>).reduce(<span class="function">(<span class="params">pre, val, i</span>) =&gt;</span></span><br><span class="line">    pre.concat(i &gt; <span class="number">1</span> ? pre[i - <span class="number">1</span>] + pre[i - <span class="number">2</span>] : ((i === <span class="number">0</span>) ? m : n)), []);</span><br><span class="line"></span><br><span class="line">fibonacci(<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤数组中的非唯一值<br>将Array.filter用于仅包含唯一值的数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filterNonUnique = <span class="function"><span class="params">arr</span> =&gt;</span> arr.filter(<span class="function"><span class="params">i</span> =&gt;</span> arr.indexOf(i) === arr.lastIndexOf(i));</span><br><span class="line"></span><br><span class="line">filterNonUnique([<span class="number">1</span>,<span class="number">22</span>,<span class="number">3</span>,<span class="number">444</span>,<span class="number">3</span>,<span class="number">22</span>,<span class="number">6</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取最大公约数<br>使用递归。基本情况是当y等于0时。在这种情况下，返回m。否则，返回n的GCD和 m/n的其余部分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcd = <span class="function">(<span class="params">m, n</span>) =&gt;</span> !n ? m : gcd(n, m % n);</span><br><span class="line"></span><br><span class="line">gcd(<span class="number">8</span>,<span class="number">36</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>函数执行计时<br>console.time</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">timeTaken = <span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'timetask'</span>);</span><br><span class="line">    <span class="keyword">let</span> r = callback();</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'timetask'</span>);</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeTaken(<span class="function"><span class="params">()</span>=&gt;</span> anagrams(<span class="string">'abcdefghij'</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>键值对转对象<br>[[‘a’,1],[‘b’,2]] -&gt; {a: 1, b: 2}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objFromPairs = <span class="function"><span class="params">arr</span> =&gt;</span> arr.reduce(<span class="function">(<span class="params">pre, val</span>) =&gt;</span> (pre[val[<span class="number">0</span>]] = val[<span class="number">1</span>], pre), &#123;&#125;);</span><br><span class="line"></span><br><span class="line">objFromPairs([[<span class="string">'a'</span>,<span class="number">1</span>],[<span class="string">'b'</span>,<span class="number">2</span>]]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>管道函数<br>pipe(func1,func2…)(args)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pipe = <span class="function">(<span class="params">...funcs</span>) =&gt;</span> arg =&gt; funcs.reduce(<span class="function">(<span class="params">funcArgs, func</span>) =&gt;</span> func(funcArgs), arg);</span><br><span class="line"></span><br><span class="line">pipe(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>, x =&gt; <span class="built_in">console</span>.log(x))(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成数组幂集<br>[1,2] -&gt; [[], [1], [2], [2,1]]</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">powerset = <span class="function"><span class="params">arr</span> =&gt;</span> arr.reduce(<span class="function">(<span class="params">pre, val</span>) =&gt;</span> pre.concat(pre.map(<span class="function"><span class="params">ele</span> =&gt;</span> [val].concat(ele))), [[]]);</span><br><span class="line"></span><br><span class="line">powerset([<span class="number">1</span>,<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>范围内随机数(默认0-100)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">randomInRange = <span class="function">(<span class="params">min = <span class="number">0</span>, max = <span class="number">100</span></span>) =&gt;</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.floor(randomInRange(<span class="number">2</span>,<span class="number">10</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>随机化数组顺序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shuffle = <span class="function"><span class="params">arr</span> =&gt;</span> arr.sort(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Math</span>.random() - <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">shuffle([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>RGB转十六进制<br>(255, 165, 1) -&gt; ‘ffa501’。 *padStart(ES2017)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//rgbToHex = (r, g, b) =&gt; ((r &lt;&lt; 16) + (g &lt;&lt; 8) + b).toString(16).padStart(6,'0');</span></span><br><span class="line">rgbToHex = <span class="function">(<span class="params">r, g, b</span>) =&gt;</span> ((r &lt;&lt; <span class="number">16</span>) + (g &lt;&lt; <span class="number">8</span>) + b).toString(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">rgbToHex(<span class="number">255</span>,<span class="number">165</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串中字母排序<br>使用split（’‘）分割字符串，sort（）使用localeCompare（），使用join(‘’)重新组合</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sortCharsInString = <span class="function"><span class="params">str</span> =&gt;</span> [...str].sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.localeCompare(b)).join(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">sortCharsInString(<span class="string">'ibsuidibjbacb'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组元素求和<br>reduce累加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sumArray = <span class="function"><span class="params">arr</span> =&gt;</span> arr.reduce(<span class="function">(<span class="params">sum, val</span>) =&gt;</span> sum + val, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">sumArray([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>交换变量值<br>数组解构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="string">'bbb'</span>;</span><br><span class="line"><span class="keyword">let</span> c = &#123; <span class="attr">key</span>: <span class="string">'value'</span> &#125;;</span><br><span class="line">[a, b, c] = [c, a, b];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(a) + <span class="string">'-'</span> + b + <span class="string">'-'</span> + c)</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组去重<br>…new Set(arr)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unique = <span class="function"><span class="params">arr</span> =&gt;</span> [...new <span class="built_in">Set</span>(arr)];</span><br><span class="line"></span><br><span class="line">unique([<span class="number">11</span>,<span class="number">22</span>,<span class="number">3</span>,<span class="number">444</span>,<span class="number">444</span>,<span class="number">55</span>,<span class="number">55</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取URL参数<br>match + reduce + map</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getUrlParameters = <span class="function"><span class="params">url</span> =&gt;</span></span><br><span class="line">    url.match(<span class="regexp">/([^?=&amp;]+)(=([^&amp;]*))/g</span>).reduce(<span class="function">(<span class="params">obj, val</span>) =&gt;</span></span><br><span class="line">        (obj[val.slice(<span class="number">0</span>, val.indexOf(<span class="string">'='</span>))] = val.slice(val.indexOf(<span class="string">'='</span>) + <span class="number">1</span>), obj), &#123;&#125;);</span><br><span class="line"></span><br><span class="line">getUrlParameters(<span class="string">'http://url.com/page?name=Adam&amp;surname=Smith'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证数字<br>使用！isNaN和parseFloat（）来检查参数是否是一个数字，使用isFinite（）来检查数字是否是有限</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">validateNumber = <span class="function"><span class="params">n</span> =&gt;</span> !<span class="built_in">isNaN</span>(<span class="built_in">parseFloat</span>(n)) &amp;&amp; <span class="built_in">isFinite</span>(n) &amp;&amp; <span class="built_in">Number</span>(n) == n;</span><br><span class="line"></span><br><span class="line">validateNumber(<span class="number">10.1</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤空值<br>空值指的是没有具体意义的一些值，比如0，undefined，null，false，空字符串等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="string">'0'</span>, <span class="literal">undefined</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="string">''</span>].filter(<span class="built_in">Boolean</span>);</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jarryliu-p.github.io/2019/05/05/前端常用代码示例-1/" data-id="cjz0vf9yg00050wv50h1n90wa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ECMAScript-JavaScript/">ECMAScript(JavaScript)</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-为什么评审代码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/05/为什么评审代码/" class="article-date">
  <time datetime="2019-05-05T06:14:24.000Z" itemprop="datePublished">2019-05-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/05/为什么评审代码/">为什么评审代码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近有位朋友问我为什么做代码评审很有价值。至少大多数硅谷科技公司都会对每一个变更进行代码评审，以确保至少有两个人看过该变更。在我之前的工作中，我们选择性地（很少地）进行代码评审，后来团队来了一位来自谷歌的新员工，他鼓励我们评审所有代码 - 而我们照做了。事实证明这是个很好的决定。</p>
<p>如果你按正确的方式进行代码评审，它不会让你觉得麻烦。你和审阅你代码的人不是对手关系，你们是一起努力构建最好的软件。（重点是不要把反馈太个人化的看待 - 即使你得改动代码，也不代表你有问题。获得反馈很正常，因为它帮助你成长！）</p>
<p>有些公司严格规定了每一段代码必须有多少人评审，以及每一段代码必须有严格的归属者。我觉得这么做完全没有必要，我更喜欢简单点的系统，唯一的规则是每段代码都至少有一个人评审过。事实上，你仍然得向维护你所改代码的人提交评审意见，但不做硬性要求会更好一些。</p>
<p>以下是我想到的为什么代码评审很有价值的几大原因。这有很多了！</p>
<ol>
<li>代码本身。代码评审最明显的价值是“发现错误”。或者如果你再深入一些，发现了一些作者不知道的最佳实践或潜在规则的情况，你可以反馈给他以改进那些具体的代码。</li>
<li>宏观层面的知识分享。当你评审别人的代码时，你其实是在学习对你有益的新技术 - 反之亦然，可能别人在评审你代码时也给你提出了更好的建议。如果你能够学以致用，你必将成长为一个工程师。</li>
<li>微观层面的知识分享。通过增加熟悉所有代码的人数，来缓和“公车因子（bus factor）”。（译注：公车因子越大，代表关键人物流失导致项目受到影响的概率越小）</li>
<li>趋势分享。相应地，代码评审迫使你与队友交流你们正在做的事情，这也确保了你们方向的正确性，而不至于数天或者数周之后才发现走在错误的方向上。</li>
<li>沟通实践。无论是在团队内部还是外部，清晰的沟通都是成功工作的最重要技能！代码评审给了你机会去练习怎么写作更清楚，不论是描述变更目的还是提交反馈的时候。而且幸运的话，下次你要写一些“非常重要”的东西时，你会发现自己已经准备好了。</li>
<li>历史记录。根据我的经验，如果人们知道他们写的东西会有人看，他们会写出更好的提交描述消息。这在回顾旧变更时非常有用！</li>
<li>可以讨论的东西。有时候你想同意某一变更，你会发现很难口头描述以及表达对比如特定算法细节等的赞同。通过一段代码进行交流会更精确些，因为代码往往比较明确。</li>
<li>团队凝聚力。当代码评审变成常规活动时，你会感觉更像是一个团队一起工作，而不是每个人“都在自己的轨道上”。</li>
<li>阅读练习。练习阅读别人的代码，有助于你把自己的代码写得更具可读性（因此，更具可维护性）。 这会让你之后写出更好的代码！<br>如果非得做个选择，那么原因 2、5、6 对我来说可能是最有价值的。</li>
</ol>
<h3 id="原文以及参考译文"><a href="#原文以及参考译文" class="headerlink" title="原文以及参考译文"></a>原文以及参考译文</h3><p><a href="https://sophiebits.com/2018/12/25/why-review-code.html" target="_blank" rel="noopener">Why review code?</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzU0Nzk1MTg5OA==&amp;mid=2247484654&amp;idx=1&amp;sn=6570b00fcc3889a95963f5f6efab67ea&amp;chksm=fb47c09bcc30498d3295f862b1688a3ff57e7380a310bd5954f35717f6a4569193c24c0f19f3&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">译文：Why review code?</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jarryliu-p.github.io/2019/05/05/为什么评审代码/" data-id="cjz0vf9yf00040wv5hm9qj47o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Code-Review/">Code Review</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ssh-keygen" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/05/ssh-keygen/" class="article-date">
  <time datetime="2019-05-05T02:44:21.000Z" itemprop="datePublished">2019-05-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/05/ssh-keygen/">ssh-keygen</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ssh-keygen-参数说明"><a href="#ssh-keygen-参数说明" class="headerlink" title="ssh-keygen 参数说明"></a><code>ssh-keygen</code> 参数说明</h2><ul>
<li><code>ssh-keygen</code> - 生成、管理和转换认证密钥</li>
<li><code>ssh-keygen</code> [-q] [-b bits] -t type [-N new_passphrase] [-C comment] [-foutput_keyfile]</li>
<li><code>ssh-keygen</code> -p [-P old_passphrase] [-N new_passphrase] [-f keyfile]</li>
<li><code>ssh-keygen</code> -i [-f input_keyfile]</li>
<li><code>ssh-keygen</code> -e [-f input_keyfile]</li>
<li><code>ssh-keygen</code> -y [-f input_keyfile]</li>
<li><code>ssh-keygen</code> -c [-P passphrase] [-C comment] [-f keyfile]</li>
<li><code>ssh-keygen</code> -l [-f input_keyfile]</li>
<li><code>ssh-keygen</code> -B [-f input_keyfile]</li>
<li><code>ssh-keygen</code> -D reader</li>
<li><code>ssh-keygen</code> -F hostname [-f known_hosts_file]</li>
<li><code>ssh-keygen</code> -H [-f known_hosts_file]</li>
<li><code>ssh-keygen</code> -R hostname [-f known_hosts_file]</li>
<li><code>ssh-keygen</code> -U reader [-f input_keyfile]</li>
<li><code>ssh-keygen</code> -r hostname [-f input_keyfile] [-g]</li>
<li><code>ssh-keygen</code> -G output_file [-v] [-b bits] [-M memory] [-S start_point]</li>
<li><code>ssh-keygen</code> -T output_file -f input_file [-v] [-a num_trials] [-W generator]</li>
</ul>
<h2 id="ssh-keygen-用于为生成、管理和转换认证密钥，包括-RSA-和-DSA-两种密钥。"><a href="#ssh-keygen-用于为生成、管理和转换认证密钥，包括-RSA-和-DSA-两种密钥。" class="headerlink" title="ssh-keygen 用于为生成、管理和转换认证密钥，包括 RSA 和 DSA 两种密钥。"></a><code>ssh-keygen</code> 用于为生成、管理和转换认证密钥，包括 RSA 和 DSA 两种密钥。</h2><p>密钥类型可以用 <code>-t</code> 选项指定。如果没有指定则默认生成用于SSH-2的RSA密钥。<br><code>ssh-keygen</code> 还可以用来产生 <code>Diffie-Hellman group exchange (DH-GEX)</code> 中使用的素数模数。<br>一般说来，如果用户希望使用 <code>RSA</code> 或 <code>DSA</code> 认证，那么至少应该运行一次这个程序，<br>在 <code>~/.ssh/identity</code>, <code>~/.ssh/id_dsa</code> 或 <code>~/.ssh/id_rsa</code> 文件中创建认证所需的密钥。<br>另外，系统管理员还可以用它产生主机密钥。<br>通常，这个程序产生一个密钥对，并要求指定一个文件存放私钥，同时将公钥存放在附加了”.pub”后缀的同名文件中。<br>程序同时要求输入一个密语字符串(passphrase)，空表示没有密语(主机密钥的密语必须为空)。<br>密语和口令(password)非常相似，但是密语可以是一句话，里面有单词、标点符号、数字、空格或任何你想要的字符。<br>好的密语要30个以上的字符，难以猜出，由大小写字母、数字、非字母混合组成。密语可以用 <code>-p</code> 选项修改。<br>丢失的密语不可恢复。如果丢失或忘记了密语，用户必须产生新的密钥，然后把相应的公钥分发到其他机器上去。<br><code>RSA1</code> 的密钥文件中有一个”注释”字段，可以方便用户标识这个密钥，指出密钥的用途或其他有用的信息。<br>创建密钥的时候，注释域初始化为”user@host”，以后可以用 <code>-c</code> 选项修改。<br>密钥产生后，下面的命令描述了怎样处置和激活密钥。可用的选项有：<br>-a trials<br>        在使用 <code>-T</code> 对 <code>DH-GEX</code> 候选素数进行安全筛选时需要执行的基本测试数量。<br>-B      显示指定的公钥/私钥文件的 <code>bubblebabble</code> 摘要。<br>-b bits<br>        指定密钥长度。对于RSA密钥，最小要求768位，默认是2048位。DSA密钥必须恰好是1024位(<code>FIPS 186-2</code> 标准的要求)。<br>-C comment<br>        提供一个新注释<br>-c      要求修改私钥和公钥文件中的注释。本选项只支持 <code>RSA1</code> 密钥。<br>        程序将提示输入私钥文件名、密语(如果存在)、新注释。<br>-D reader<br>        下载存储在智能卡 <code>reader</code> 里的 <code>RSA</code> 公钥。<br>-e      读取OpenSSH的私钥或公钥文件，并以 <code>RFC</code> 4716 <code>SSH</code> 公钥文件格式在 <code>stdout</code> 上显示出来。<br>        该选项能够为多种商业版本的 <code>SSH</code> 输出密钥。<br>-F hostname<br>        在 <code>known_hosts</code> 文件中搜索指定的 <code>hostname</code> ，并列出所有的匹配项。<br>        这个选项主要用于查找散列过的主机名/<code>ip</code>地址，还可以和 <code>-H</code> 选项联用打印找到的公钥的散列值。<br>-f filename<br>        指定密钥文件名。<br>-G output_file<br>        为 <code>DH-GEX</code> 产生候选素数。这些素数必须在使用之前使用 <code>-T</code> 选项进行安全筛选。<br>-g      在使用 <code>-r</code> 打印指纹资源记录的时候使用通用的 <code>DNS</code> 格式。<br>-H      对 <code>known_hosts</code> 文件进行散列计算。这将把文件中的所有主机名/<code>ip</code>地址替换为相应的散列值。<br>        原来文件的内容将会添加一个”.old”后缀后保存。这些散列值只能被 <code>ssh</code> 和 <code>sshd</code> 使用。<br>        这个选项不会修改已经经过散列的主机名/<code>ip</code>地址，因此可以在部分公钥已经散列过的文件上安全使用。<br>-i      读取未加密的 <code>SSH-2</code> 兼容的私钥/公钥文件，然后在 <code>stdout</code> 显示 <code>OpenSSH</code> 兼容的私钥/公钥。<br>        该选项主要用于从多种商业版本的 <code>SSH</code> 中导入密钥。<br>-l      显示公钥文件的指纹数据。它也支持 <code>RSA1</code> 的私钥。<br>        对于 <code>RSA</code> 和 <code>DSA</code> 密钥，将会寻找对应的公钥文件，然后显示其指纹数据。<br>-M memory<br>        指定在生成 <code>DH-GEXS</code> 候选素数的时候最大内存用量(<code>MB</code>)。<br>-N new_passphrase<br>        提供一个新的密语。<br>-P passphrase<br>        提供(旧)密语。<br>-p      要求改变某私钥文件的密语而不重建私钥。程序将提示输入私钥文件名、原来的密语、以及两次输入新密语。<br>-q      安静模式。用于在 <code>/etc/rc</code> 中创建新密钥的时候。<br>-R hostname<br>        从 <code>known_hosts</code> 文件中删除所有属于 <code>hostname</code> 的密钥。<br>        这个选项主要用于删除经过散列的主机(参见 <code>-H</code> 选项)的密钥。<br>-r hostname<br>        打印名为 <code>hostname</code> 的公钥文件的 <code>SSHFP</code> 指纹资源记录。<br>-S start<br>        指定在生成 <code>DH-GEX</code> 候选模数时的起始点(16进制)。<br>-T output_file<br>        测试 <code>Diffie-Hellman group exchange</code> 候选素数(由 <code>-G</code> 选项生成)的安全性。<br>-t type<br>        指定要创建的密钥类型。可以使用：”rsa1”(<code>SSH-1</code>) “rsa”(<code>SSH-2</code>) “dsa”(<code>SSH-2</code>)<br>-U reader<br>        把现存的 <code>RSA</code> 私钥上传到智能卡 <code>reader</code><br>-v      详细模式。<code>ssh-keygen</code> 将会输出处理过程的详细调试信息。常用于调试模数的产生过程。<br>        重复使用多个 <code>-v</code> 选项将会增加信息的详细程度(最大3次)。<br>-W generator<br>        指定在为 <code>DH-GEX</code> 测试候选模数时想要使用的 <code>generator</code><br>-y      读取 <code>OpenSSH</code> 专有格式的公钥文件，并将 <code>OpenSSH</code> 公钥显示在 <code>stdout</code> 上。<br>ssh-keygen 可以生成用于 <code>Diffie-Hellman Group Exchange (DH-GEX)</code> 协议的 <code>groups</code> 。<br>生成过程分为两步：<br>首先，使用一个快速且消耗内存较多的方法生成一些候选素数。然后，对这些素数进行适应性测试(消耗<code>CPU</code>较多)。<br>可以使用 <code>-G</code> 选项生成候选素数，同时使用 <code>-b</code> 选项制定其位数。例如：</p>
<h3 id="ssh-keygen-G-moduli-2048-candidates-b-2048"><a href="#ssh-keygen-G-moduli-2048-candidates-b-2048" class="headerlink" title="ssh-keygen -G moduli-2048.candidates -b 2048"></a>ssh-keygen -G moduli-2048.candidates -b 2048</h3><p>默认将从指定位数范围内的一个随机点开始搜索素数，不过可以使用 <code>-S</code> 选项来指定这个随机点(16进制)。<br>生成一组候选数之后，接下来就需要使用 <code>-T</code> 选项进行适应性测试。<br>此时 <code>ssh-keygen</code> 将会从 <code>stdin</code> 读取候选素数(或者通过 <code>-f</code> 选项读取一个文件)，例如：</p>
<h3 id="ssh-keygen-T-moduli-2048-f-moduli-2048-candidates"><a href="#ssh-keygen-T-moduli-2048-f-moduli-2048-candidates" class="headerlink" title="ssh-keygen -T moduli-2048 -f moduli-2048.candidates"></a>ssh-keygen -T moduli-2048 -f moduli-2048.candidates</h3><p>每个候选素数默认都要通过 100 个基本测试(可以通过 <code>-a</code> 选项修改)。<br><code>DH generator</code> 的值会自动选择，但是你也可以通过 <code>-W</code> 选项强制指定。有效的值可以是： 2, 3, 5<br>经过筛选之后的 <code>DH groups</code> 就可以存放到 <code>/etc/ssh/moduli</code> 里面了。<br>很重要的一点是这个文件必须包括不同长度范围的模数，而且通信双方双方共享相同的模数。</p>
<h3 id="ssh-identity"><a href="#ssh-identity" class="headerlink" title="~/.ssh/identity"></a>~/.ssh/identity</h3><p>该用户默认的 <code>RSA1</code> 身份认证私钥(<code>SSH-1</code>)。此文件的权限应当至少限制为”600”。<br>生成密钥的时候可以指定采用密语来加密该私钥(<code>3DES</code>)。<br>将在登录的时候读取这个文件。</p>
<h3 id="ssh-identity-pub"><a href="#ssh-identity-pub" class="headerlink" title="~/.ssh/identity.pub"></a>~/.ssh/identity.pub</h3><p>该用户默认的 <code>RSA1</code> 身份认证公钥(<code>SSH-1</code>)。此文件无需保密。<br>此文件的内容应该添加到所有 <code>RSA1</code> 目标主机的 <code>~/.ssh/authorized_keys</code> 文件中。</p>
<h3 id="ssh-id-dsa"><a href="#ssh-id-dsa" class="headerlink" title="~/.ssh/id_dsa"></a>~/.ssh/id_dsa</h3><p>该用户默认的 <code>DSA</code> 身份认证私钥(<code>SSH-2</code>)。此文件的权限应当至少限制为”600”。<br>生成密钥的时候可以指定采用密语来加密该私钥(<code>3DES</code>)。<br>将在登录的时候读取这个文件。</p>
<h3 id="ssh-id-dsa-pub"><a href="#ssh-id-dsa-pub" class="headerlink" title="~/.ssh/id_dsa.pub"></a>~/.ssh/id_dsa.pub</h3><p>该用户默认的 <code>DSA</code> 身份认证公钥(<code>SSH-2</code>)。此文件无需保密。<br>此文件的内容应该添加到所有 <code>DSA</code> 目标主机的 <code>~/.ssh/authorized_keys</code> 文件中。</p>
<h3 id="ssh-id-rsa"><a href="#ssh-id-rsa" class="headerlink" title="~/.ssh/id_rsa"></a>~/.ssh/id_rsa</h3><p>该用户默认的 <code>RSA</code> 身份认证私钥(<code>SSH-2</code>)。此文件的权限应当至少限制为”600”。<br>生成密钥的时候可以指定采用密语来加密该私钥(<code>3DES</code>)。<br>将在登录的时候读取这个文件。</p>
<h3 id="ssh-id-rsa-pub"><a href="#ssh-id-rsa-pub" class="headerlink" title="~/.ssh/id_rsa.pub"></a>~/.ssh/id_rsa.pub</h3><p>该用户默认的 <code>RSA</code> 身份认证公钥(<code>SSH-2</code>)。此文件无需保密。<br>此文件的内容应该添加到所有 <code>RSA</code> 目标主机的 <code>~/.ssh/authorized_keys</code> 文件中。</p>
<h3 id="etc-ssh-moduli"><a href="#etc-ssh-moduli" class="headerlink" title="/etc/ssh/moduli"></a>/etc/ssh/moduli</h3><p>包含用于 <code>DH-GEX</code> 的 <code>Diffie-Hellman groups</code> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jarryliu-p.github.io/2019/05/05/ssh-keygen/" data-id="cjz0vf9z3000m0wv5jfsf4f8y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSH/">SSH</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx-默认mimetype集合" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/30/Nginx-默认mimetype集合/" class="article-date">
  <time datetime="2019-04-30T07:05:34.000Z" itemprop="datePublished">2019-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/30/Nginx-默认mimetype集合/">Nginx-默认mimetype集合</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">types &#123;</span><br><span class="line">    text/html                                        html htm shtml;</span><br><span class="line">    text/css                                         css;</span><br><span class="line">    text/xml                                         xml;</span><br><span class="line">    image/gif                                        gif;</span><br><span class="line">    image/jpeg                                       jpeg jpg;</span><br><span class="line">    application/javascript                           js;</span><br><span class="line">    application/atom+xml                             atom;</span><br><span class="line">    application/rss+xml                              rss;</span><br><span class="line"></span><br><span class="line">    text/mathml                                      mml;</span><br><span class="line">    text/plain                                       txt;</span><br><span class="line">    text/vnd.sun.j2me.app-descriptor                 jad;</span><br><span class="line">    text/vnd.wap.wml                                 wml;</span><br><span class="line">    text/x-component                                 htc;</span><br><span class="line"></span><br><span class="line">    image/png                                        png;</span><br><span class="line">    image/svg+xml                                    svg svgz;</span><br><span class="line">    image/tiff                                       tif tiff;</span><br><span class="line">    image/vnd.wap.wbmp                               wbmp;</span><br><span class="line">    image/webp                                       webp;</span><br><span class="line">    image/x-icon                                     ico;</span><br><span class="line">    image/x-jng                                      jng;</span><br><span class="line">    image/x-ms-bmp                                   bmp;</span><br><span class="line"></span><br><span class="line">    font/woff                                        woff;</span><br><span class="line">    font/woff2                                       woff2;</span><br><span class="line"></span><br><span class="line">    application/java-archive                         jar war ear;</span><br><span class="line">    application/json                                 json;</span><br><span class="line">    application/mac-binhex40                         hqx;</span><br><span class="line">    application/msword                               doc;</span><br><span class="line">    application/pdf                                  pdf;</span><br><span class="line">    application/postscript                           ps eps ai;</span><br><span class="line">    application/rtf                                  rtf;</span><br><span class="line">    application/vnd.apple.mpegurl                    m3u8;</span><br><span class="line">    application/vnd.google-earth.kml+xml             kml;</span><br><span class="line">    application/vnd.google-earth.kmz                 kmz;</span><br><span class="line">    application/vnd.ms-excel                         xls;</span><br><span class="line">    application/vnd.ms-fontobject                    eot;</span><br><span class="line">    application/vnd.ms-powerpoint                    ppt;</span><br><span class="line">    application/vnd.oasis.opendocument.graphics      odg;</span><br><span class="line">    application/vnd.oasis.opendocument.presentation  odp;</span><br><span class="line">    application/vnd.oasis.opendocument.spreadsheet   ods;</span><br><span class="line">    application/vnd.oasis.opendocument.text          odt;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.presentationml.presentation</span><br><span class="line">                                                     pptx;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</span><br><span class="line">                                                     xlsx;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.wordprocessingml.document</span><br><span class="line">                                                     docx;</span><br><span class="line">    application/vnd.wap.wmlc                         wmlc;</span><br><span class="line">    application/x-7z-compressed                      7z;</span><br><span class="line">    application/x-cocoa                              cco;</span><br><span class="line">    application/x-java-archive-diff                  jardiff;</span><br><span class="line">    application/x-java-jnlp-file                     jnlp;</span><br><span class="line">    application/x-makeself                           run;</span><br><span class="line">    application/x-perl                               pl pm;</span><br><span class="line">    application/x-pilot                              prc pdb;</span><br><span class="line">    application/x-rar-compressed                     rar;</span><br><span class="line">    application/x-redhat-package-manager             rpm;</span><br><span class="line">    application/x-sea                                sea;</span><br><span class="line">    application/x-shockwave-flash                    swf;</span><br><span class="line">    application/x-stuffit                            sit;</span><br><span class="line">    application/x-tcl                                tcl tk;</span><br><span class="line">    application/x-x509-ca-cert                       der pem crt;</span><br><span class="line">    application/x-xpinstall                          xpi;</span><br><span class="line">    application/xhtml+xml                            xhtml;</span><br><span class="line">    application/xspf+xml                             xspf;</span><br><span class="line">    application/zip                                  zip;</span><br><span class="line"></span><br><span class="line">    application/octet-stream                         bin exe dll;</span><br><span class="line">    application/octet-stream                         deb;</span><br><span class="line">    application/octet-stream                         dmg;</span><br><span class="line">    application/octet-stream                         iso img;</span><br><span class="line">    application/octet-stream                         msi msp msm;</span><br><span class="line"></span><br><span class="line">    audio/midi                                       mid midi kar;</span><br><span class="line">    audio/mpeg                                       mp3;</span><br><span class="line">    audio/ogg                                        ogg;</span><br><span class="line">    audio/x-m4a                                      m4a;</span><br><span class="line">    audio/x-realaudio                                ra;</span><br><span class="line"></span><br><span class="line">    video/3gpp                                       3gpp 3gp;</span><br><span class="line">    video/mp2t                                       ts;</span><br><span class="line">    video/mp4                                        mp4;</span><br><span class="line">    video/mpeg                                       mpeg mpg;</span><br><span class="line">    video/quicktime                                  mov;</span><br><span class="line">    video/webm                                       webm;</span><br><span class="line">    video/x-flv                                      flv;</span><br><span class="line">    video/x-m4v                                      m4v;</span><br><span class="line">    video/x-mng                                      mng;</span><br><span class="line">    video/x-ms-asf                                   asx asf;</span><br><span class="line">    video/x-ms-wmv                                   wmv;</span><br><span class="line">    video/x-msvideo                                  avi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jarryliu-p.github.io/2019/04/30/Nginx-默认mimetype集合/" data-id="cjz0vf9yc00020wv5p2v69h8f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MIME-Type/">MIME Type</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx-基础使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/30/Nginx-基础使用/" class="article-date">
  <time datetime="2019-04-30T03:19:54.000Z" itemprop="datePublished">2019-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/30/Nginx-基础使用/">Nginx-基础使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Nginx-engine-x-是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP-POP3-SMTP服务。"><a href="#Nginx-engine-x-是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP-POP3-SMTP服务。" class="headerlink" title="Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。"></a><code>Nginx</code> (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。</h3><h4 id="常用场景"><a href="#常用场景" class="headerlink" title="常用场景"></a>常用场景</h4><ul>
<li><a href="#1">静态资源服务器</a></li>
<li><a href="#2">代理服务</a></li>
<li><a href="#3">跨站资源访问</a></li>
<li><a href="#4">适配PC与移动端环境</a></li>
<li><a href="#5">负载均衡调度</a></li>
<li><a href="#6">缓存服务</a></li>
<li><a href="#7">简单的访问控制</a></li>
<li><a href="#8">图片处理</a></li>
</ul>
<h4 id="默认配置文件"><a href="#默认配置文件" class="headerlink" title="默认配置文件"></a>默认配置文件</h4><p>全局块：<code>nginx</code> 全局配置。比如用户以及用户组 <code>user</code>，<code>nginx</code> 进程 <code>pid</code> 文件存放路径，日志存放路径 <code>error_log</code>，工作进程<code>worker process</code> 数等，也可以引入配置文件。</p>
<p><code>events</code> 块：服务器连接相关配置。比如进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</p>
<p><code>http</code> 块：可嵌套多个虚拟主机 <code>server</code>，配置代理，设置缓存，配置日志定义等。支持很多第三方模块的配置。比如文件引入，<code>mime-type</code> 定义，图片压缩，日志自定义，传输文件配置，设置连接超时时间，单个连接请求数等等。</p>
<p><code>server</code> 块：虚拟主机的相关配置。</p>
<p><code>location</code> 块：请求的路由相关配置，特殊页面的处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"># &#123;全局块&#125;</span><br><span class="line"></span><br><span class="line"># 设置用户组</span><br><span class="line">#user  nobody;</span><br><span class="line"># 配置用户或者组，默认为nobody nobody。</span><br><span class="line">#user admin admin;  </span><br><span class="line"></span><br><span class="line"># 设置工作进程的数量</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"># 指定日志路径，日志级别包括 debug | info | notice | warn | error | alert 等</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"># 指定进程文件</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123; # &#123;event块&#125;</span><br><span class="line">    # 设置一个进程是否同时接受多个网络连接，默认为off</span><br><span class="line">    #multi_accept on;</span><br><span class="line">    # 事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class="line">    #use epoll;</span><br><span class="line">    # 进程的最大连接数</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123; &#123;#http块&#125;</span><br><span class="line">    # 文件拓展名查找集合</span><br><span class="line">    include       mime.types;</span><br><span class="line">    # 默认文件类型为文件流，匹配.*</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 日志格式定义，main为日志别名</span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    # 取消服务日志</span><br><span class="line">    #access_log off;</span><br><span class="line">    # 指定日志输入文件</span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    # 调用 sendfile 系统传输文件，sendfile on 表示通过文件描述符直接拷贝，而不是用read()/write()</span><br><span class="line">    sendfile        on;</span><br><span class="line">    # tcp_nopush = on 会设置调用tcp_cork方法，这个也是默认的，结果就是数据包不会马上传送出去，等到数据包最大时，一次性的传输出去，这样有助于解决网络堵塞。</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    # 设置连接超时时间</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    # 是否启用 gzip 压缩，需要浏览器支持，需要解压缩</span><br><span class="line">    #gzip  on;</span><br><span class="line">    # 设置gzip所需的http协议最低版本 （HTTP/1.1, HTTP/1.0）</span><br><span class="line">    #gzip_http_version 1.1;</span><br><span class="line">    # 设置压缩级别，压缩级别越高压缩时间越长  （1-9）</span><br><span class="line">    #gzip_comp_level 4;</span><br><span class="line">    # 设置压缩的最小字节数， 页面Content-Length获取</span><br><span class="line">    #gzip_min_length 1000;</span><br><span class="line">    # 设置压缩文件的类型</span><br><span class="line">    #gzip_types text/plain application/javascript text/css;</span><br><span class="line"></span><br><span class="line">    server &#123; #&#123;server块&#125;</span><br><span class="line">        # 监听端口</span><br><span class="line">        listen       80;</span><br><span class="line">        # 虚拟主机名称</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        # 设置编码字符集</span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        # 指定日志输入文件</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        # 监听请求路由</span><br><span class="line">        location / &#123; #&#123;location块&#125;</span><br><span class="line">            # 查找根目录</span><br><span class="line">            root   html;</span><br><span class="line">            # 默认匹配</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        # 重定位服务器错误到静态页面 /50x.html</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">        # concurs with nginx&apos;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="nginx-内置变量"><a href="#nginx-内置变量" class="headerlink" title="nginx 内置变量"></a><code>nginx</code> 内置变量</h3><ul>
<li>$args ： #这个变量等于请求行中的参数，同 <code>$query_string</code></li>
<li>$content_length ： 请求头中的 <code>Content-length</code> 字段。</li>
<li>$content_type ： 请求头中的 <code>Content-Type</code> 字段。</li>
<li>$document_root ： 当前请求在 <code>root</code> 指令中指定的值。</li>
<li>$host ： 请求主机头字段，否则为服务器名称。</li>
<li>$http_user_agent ： 客户端 <code>agent</code> 信息</li>
<li>$http_cookie ： 客户端 <code>cookie</code> 信息</li>
<li>$limit_rate ： 这个变量可以限制连接速率。</li>
<li>$request_method ： 客户端请求的动作，通常为 <code>GET</code> 或 <code>POST</code>。</li>
<li>$remote_addr ： 客户端的 <code>IP</code> 地址。</li>
<li>$remote_port ： 客户端的端口。</li>
<li>$remote_user ： 已经经过 <code>Auth Basic Module</code> 验证的用户名。</li>
<li>$request_filename ： 当前请求的文件路径，由 <code>root</code> 或 <code>alias</code> 指令与 <code>URI</code> 请求生成。</li>
<li>$scheme ： <code>HTTP</code> 方法（如 <code>http</code> ，<code>https</code>）。</li>
<li>$server_protocol ： 请求使用的协议，通常是 <code>HTTP/1.0</code> 或 <code>HTTP/1.1</code>。</li>
<li>$server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。</li>
<li>$server_name ： 服务器名称。</li>
<li>$server_port ： 请求到达服务器的端口号。</li>
<li>$request_uri ： 包含请求参数的原始 <code>URI</code>，不包含主机名，如：”/foo/bar.php?arg=baz”。</li>
<li>$uri ： 不带请求参数的当前 <code>URI</code>，<code>$uri</code> 不包含主机名，如”/foo/bar.html”。</li>
<li>$document_uri ： 与 <code>$uri</code> 相同</li>
</ul>
<h3 id="nginx-基本命令"><a href="#nginx-基本命令" class="headerlink" title="nginx 基本命令"></a><code>nginx</code> 基本命令</h3><ul>
<li>nginx -t 检查配置文件是否有语法错误</li>
<li>nginx -s reload 向主进程发送信号，重新加载配置文件</li>
<li>nginx -s stop 快速关闭</li>
<li>nginx -s quit 等待工作进程处理完成后关闭</li>
</ul>
<h3 id="location-匹配规则（优先级递减）"><a href="#location-匹配规则（优先级递减）" class="headerlink" title="location 匹配规则（优先级递减）"></a><code>location</code> 匹配规则（优先级递减）</h3><table>
<thead>
<tr>
<th style="text-align:right">匹配符</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">=</td>
<td style="text-align:left">进行普通字符精确匹配。也就是完全匹配</td>
</tr>
<tr>
<td style="text-align:right">^~</td>
<td style="text-align:left">前缀匹配。如果匹配成功，则不再匹配其他location</td>
</tr>
</tbody>
</table>
<p>v~|表示执行一个正则匹配，区分大小写|<br>|~*|表示执行一个正则匹配，不区分大小写|<br>|/xxx/|常规字符串路径匹配|<br>|/|通用匹配，任何请求都会匹配到|</p>
<h4 id="静态资源服务器"><a href="#静态资源服务器" class="headerlink" title="静态资源服务器"></a><span id="1">静态资源服务器<span></span></span></h4><p>常见的静态资源包括图片，文档，视频等文件，所以 <code>nginx</code> 常用来作为静态网站服务器，或者作为 <code>cdn</code> 资源服务器。<br>例如以下是一个前后端分离的工程的前端工程部署配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen  8080;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    root html/project;</span><br><span class="line">    location / &#123;</span><br><span class="line">        // 按照优先级 &apos;$uri&apos; &gt; &apos;$uri/&apos; &gt; &apos;/index.html&apos; &gt; &apos;=404&apos;依次匹配</span><br><span class="line">        try_files $uri $uri/ /index.html =404;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="代理服务"><a href="#代理服务" class="headerlink" title="代理服务"></a><span id="2">代理服务<span></span></span></h4><p><code>nginx</code> 用作代理服务器可以作为正向代理或者反向代理，而反向代理正是跨站资源访问的解决方案之一。<br>如下是正向代理配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen  8080;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    # DNS 域名解析服务器</span><br><span class="line">    resolver 8.8.8.8;</span><br><span class="line">    # 解析超时时间</span><br><span class="line">    resolver_timeout 5s;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   $scheme://$http_host/$request_uri;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line"></span><br><span class="line">        proxy_buffers 256 4k;</span><br><span class="line">        proxy_max_temp_file_size 0;</span><br><span class="line"></span><br><span class="line">        proxy_connect_timeout 30;</span><br><span class="line"></span><br><span class="line">        proxy_cache_valid 200 302 10m;</span><br><span class="line">        proxy_cache_valid 301 1h;</span><br><span class="line">        proxy_cache_valid any 1m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一次代理，直接在shell执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy=http://x.x.x.x:8080</span><br></pre></td></tr></table></figure></p>
<p>永久使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line">export http_proxy=http://x.x.x.x:8080</span><br><span class="line">source .bashrc # 刷新以加载变量</span><br></pre></td></tr></table></figure></p>
<h4 id="跨站资源访问"><a href="#跨站资源访问" class="headerlink" title="跨站资源访问"></a><span id="3">跨站资源访问<span></span></span></h4><p>反向代理配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location /api &#123;</span><br><span class="line">        # 代理转发</span><br><span class="line">        proxy_pass http://localhost:8081;</span><br><span class="line">        # 路径重写（如果需要）</span><br><span class="line">        # rewrite  /api/(.*)  /$1  break;</span><br><span class="line"></span><br><span class="line">        # 请求host传给后端</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        # 设置用户ip地址</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line"></span><br><span class="line">        proxy_buffers 256 4k;</span><br><span class="line">        proxy_max_temp_file_size 0;</span><br><span class="line"></span><br><span class="line">        # 代理超时时间</span><br><span class="line">        proxy_connect_timeout 30;</span><br><span class="line"></span><br><span class="line">        # 当请求服务器出错去寻找其他服务器</span><br><span class="line">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="适配PC与移动端环境"><a href="#适配PC与移动端环境" class="headerlink" title="适配PC与移动端环境"></a><span id="4">适配PC与移动端环境<span></span></span></h4><p><code>nginx</code> 可以通过内置变量 <code>$http_user_agent</code>，获取到请求客户端的 <code>userAgent</code>，从而知道用户处于移动端还是PC，进而控制重定向到H5站还是PC站。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 移动、pc设备适配</span><br><span class="line">        if ($http_user_agent ~* &apos;(Android|webOS|iPhone|iPod|BlackBerry)&apos;) &#123;</span><br><span class="line">            set $mobile_request &apos;1&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($mobile_request = &apos;1&apos;) &#123;</span><br><span class="line">            rewrite ^.+ http://mysite-base-H5.com;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="负载均衡调度"><a href="#负载均衡调度" class="headerlink" title="负载均衡调度"></a><span id="5">负载均衡调度<span></span></span></h4><p>RR（round robin：轮询）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    upstream web_servers &#123;  </span><br><span class="line">        server localhost:8081;  </span><br><span class="line">        server localhost:8082;  </span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        ...</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://web_servers;</span><br><span class="line">            # 必须指定Header Host</span><br><span class="line">            proxy_set_header Host $host:$server_port;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按权重分配<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8081 weight=1;</span><br><span class="line">    server localhost:8082 weight=3;</span><br><span class="line">    server localhost:8083 weight=4 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按地址分配：ip_hash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>后端服务器的响应时间来分配：fair(第三方)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    fair;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按访问url的hash结果来分配：url_hash(第三方)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    hash $request_uri;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="缓存服务"><a href="#缓存服务" class="headerlink" title="缓存服务"></a><span id="6">缓存服务<span></span></span></h4><p>对扩展名为 <code>gif</code>，<code>jpg</code>，<code>jpeg</code>，<code>png</code>，<code>bmp</code>，<code>swf</code>，<code>js</code>，<code>css</code> 的图片，<code>flash</code>，<code>javascript</code>，<code>css</code> 文件开启 <code>Web</code> 缓存,其他文件不缓存。配置文件如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">user  www;</span><br><span class="line">worker_processes  8;</span><br><span class="line">  </span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  65535;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    charset utf-8;</span><br><span class="line"> </span><br><span class="line">    log_format  main  &apos;$http_x_forwarded_for $remote_addr $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_cookie&quot; $host $request_time&apos;;</span><br><span class="line">    sendfile       on;</span><br><span class="line">    tcp_nopush     on;</span><br><span class="line">    tcp_nodelay    on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"> </span><br><span class="line">    #要想开启nginx的缓存功能，需要添加此处的两行内容！</span><br><span class="line">    #设置Web缓存区名称为cache_one,内存缓存空间大小为500M,缓存的数据超过1天没有被访问就自动清除;访问的缓存数据,硬盘缓存空间大小为30G</span><br><span class="line">    proxy_cache_path /usr/local/nginx/proxy_cache_path levels=1:2 keys_zone=cache_one:500m inactive=1d max_size=30g;</span><br><span class="line"> </span><br><span class="line">    #创建缓存的时候可能生成一些临时文件存放的位置</span><br><span class="line">    proxy_temp_path /usr/local/nginx/proxy_temp_path;</span><br><span class="line"> </span><br><span class="line">    fastcgi_connect_timeout 3000;</span><br><span class="line">    fastcgi_send_timeout 3000;</span><br><span class="line">    fastcgi_read_timeout 3000;</span><br><span class="line">    fastcgi_buffer_size 256k;</span><br><span class="line">    fastcgi_buffers 8 256k;</span><br><span class="line">    fastcgi_busy_buffers_size 256k;</span><br><span class="line">    fastcgi_temp_file_write_size 256k;</span><br><span class="line">    fastcgi_intercept_errors on;</span><br><span class="line">  </span><br><span class="line">     </span><br><span class="line">    client_header_timeout 600s;</span><br><span class="line">    client_body_timeout 600s;</span><br><span class="line">  </span><br><span class="line">    client_max_body_size 100m;             </span><br><span class="line">    client_body_buffer_size 256k;           </span><br><span class="line">  </span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_min_length  1k;</span><br><span class="line">    gzip_buffers     4 16k;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_comp_level 9;</span><br><span class="line">    gzip_types       text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">    upstream LB-WWW &#123;</span><br><span class="line">      ip_hash;</span><br><span class="line">      server 192.168.1.101:80 max_fails=3 fail_timeout=30s;     #max_fails = 3 为允许失败的次数，默认值为1</span><br><span class="line">      server 192.168.1.102:80 max_fails=3 fail_timeout=30s;     #fail_timeout = 30s 当max_fails次失败后，暂停将请求分发到该后端服务器的时间</span><br><span class="line">      server 192.168.1.118:80 max_fails=3 fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.wangshibo.com;</span><br><span class="line">        index index.html index.php index.htm;</span><br><span class="line">        root /var/www/html;</span><br><span class="line">    </span><br><span class="line">        access_log  /usr/local/nginx/logs/www-access.log main;</span><br><span class="line">        error_log  /usr/local/nginx/logs/www-error.log;</span><br><span class="line">    </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://LB-WWW;</span><br><span class="line">            proxy_redirect off ;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            #跟后端服务器连接超时时间，发起握手等候响应时间</span><br><span class="line">            proxy_connect_timeout 300;</span><br><span class="line">            #后端服务器回传时间，就是在规定时间内后端服务器必须传完所有数据</span><br><span class="line">            proxy_send_timeout 300;</span><br><span class="line">            #连接成功后等待后端服务器的响应时间，已经进入后端的排队之中等候处理</span><br><span class="line">            proxy_read_timeout 600;</span><br><span class="line">            #代理请求缓冲区,会保存用户的头信息以供nginx进行处理</span><br><span class="line">            proxy_buffer_size 256k;</span><br><span class="line">            #同上，告诉nginx保存单个用几个buffer最大用多少空间</span><br><span class="line">            proxy_buffers 4 256k;</span><br><span class="line">            #如果系统很忙时候可以申请最大的proxy_buffers</span><br><span class="line">            proxy_busy_buffers_size 256k;</span><br><span class="line">            #proxy缓存临时文件的大小</span><br><span class="line">            proxy_temp_file_write_size 256k;</span><br><span class="line">            proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;</span><br><span class="line">            proxy_max_temp_file_size 128m;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css)$ &#123;         </span><br><span class="line">            #使用Web缓存区cache_one，已在nginx.conf的缓存配置中命名的。</span><br><span class="line">            proxy_cache cache_one ;</span><br><span class="line">            #对不同HTTP状态码缓存设置不同的缓存时间</span><br><span class="line">            proxy_cache_valid 200 304 12h ;</span><br><span class="line">            proxy_cache_valid 301 302 1m ;</span><br><span class="line">            proxy_cache_valid any 1m ;</span><br><span class="line">            #设置Web缓存的Key值,Nginx根据Key值md5哈希存储缓存,这里根据&quot;域名,URI,</span><br><span class="line">            #参数&quot;组合成Key</span><br><span class="line">            proxy_cache_key $host$uri$is_args$args;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        #用于清除缓存的url设置</span><br><span class="line">        #假设一个URL为http://www.wangshibo.com/test.gif,那么就可以通过访问http://www.wangshibo.com/purge/test.gif清除该URL的缓存。</span><br><span class="line">        location ~ /purge(/.*) &#123;</span><br><span class="line">            #设置只允许指定的IP或IP段才可以清除URL缓存</span><br><span class="line">            allow 127.0.0.1 ;</span><br><span class="line">            allow 192.168.0.0/16 ;</span><br><span class="line">            deny all ;</span><br><span class="line">            proxy_cache_purge cache_one $host$1$is_args$args ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="简单的访问控制"><a href="#简单的访问控制" class="headerlink" title="简单的访问控制"></a><span id="7">简单的访问控制<span></span></span></h4><p><code>deny</code> 和 <code>allow</code> 是 <code>ngx_http_access_module</code> 模块（已内置）中的语法。采用的是从上到下匹配方式，匹配到就跳出不再继续匹配。上述配置的意思就是，首先禁止 <code>192.168.1.100</code> 访问，然后允许 <code>192.168.1.10-200</code> ip段内的访问（排除 <code>192.168.1.100</code>），同时允许 <code>10.110.50.16</code> 这个单独ip的访问，剩下未匹配到的全部禁止访问。实际生产中，经常和 <code>ngx_http_geo_module</code> 模块（可以更好地管理ip地址表，已内置）配合使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location / &#123;</span><br><span class="line">        deny  192.168.1.100;</span><br><span class="line">        allow 192.168.1.10/200;</span><br><span class="line">        allow 10.110.50.16;</span><br><span class="line">        deny  all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a><span id="8">图片处理<span></span></span></h4><p>满足日常对图片的裁剪/缩放/旋转/图片品质等处理需求。要用到 <code>ngx_http_image_filter_module</code> 模块。这个模块是非基本模块，需要安装。 下面是图片缩放功能部分的 <code>nginx</code> 配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    # 图片缩放处理</span><br><span class="line">    # 这里约定的图片处理url格式：以 mysite-base.com/img/路径访问</span><br><span class="line">    location ~* /img/(.+)$ &#123;</span><br><span class="line">        #图片服务端储存地址</span><br><span class="line">        alias /Users/cc/Desktop/server/static/image/$1;</span><br><span class="line">        #图片宽度默认值</span><br><span class="line">        set $width -;</span><br><span class="line">        #图片高度默认值</span><br><span class="line">        set $height -;</span><br><span class="line">        if ($arg_width != &quot;&quot;) &#123;</span><br><span class="line">            set $width $arg_width;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($arg_height != &quot;&quot;) &#123;</span><br><span class="line">            set $height $arg_height;</span><br><span class="line">        &#125;</span><br><span class="line">        #设置图片宽高</span><br><span class="line">        image_filter resize $width $height;</span><br><span class="line">        #设置Nginx读取图片的最大buffer</span><br><span class="line">        image_filter_buffer 10M;</span><br><span class="line">        #是否开启图片图像隔行扫描</span><br><span class="line">        image_filter_interlace on;</span><br><span class="line">        #图片处理错误提示图，例如缩放参数不是数字</span><br><span class="line">        error_page 415 = 415.png; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="参考网站以及文章"><a href="#参考网站以及文章" class="headerlink" title="参考网站以及文章"></a>参考网站以及文章</h3><p><a href="https://nginx.org/" target="_blank" rel="noopener">nginx官网</a></p>
<p><a href="https://juejin.im/post/5bacbd395188255c8d0fd4b2" target="_blank" rel="noopener">Nginx与前端开发</a></p>
<p><a href="https://juejin.im/post/5cae9de95188251ae2324ec3" target="_blank" rel="noopener">前端想要了解的Nginx</a></p>
<p><a href="https://www.jianshu.com/p/577d022f5693" target="_blank" rel="noopener">Nginx常见使用场景-WEB服务(四)</a></p>
<p><a href="https://blog.csdn.net/vbirdbest/article/details/80913319" target="_blank" rel="noopener">nginx应用场景</a></p>
<p><a href="https://www.cnblogs.com/zhang-shijie/p/5498623.html" target="_blank" rel="noopener">Nginx 之六： Nginx服务器的正向及反向代理功能</a></p>
<p><a href="https://www.cnblogs.com/cuishuai/p/8073748.html" target="_blank" rel="noopener">nginx之正向代理</a></p>
<p><a href="https://www.cnblogs.com/kevingrace/p/6198287.html" target="_blank" rel="noopener">nginx的web缓存服务环境部署记录</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jarryliu-p.github.io/2019/04/30/Nginx-基础使用/" data-id="cjz0vf9zi00120wv5knj834zf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code-Review/">Code Review</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-JavaScript/">ECMAScript(JavaScript)</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Layout/">Layout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIME-Type/">MIME Type</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/">SSH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/T-T/">T&T</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/systemctl/">systemctl</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Code-Review/" style="font-size: 10px;">Code Review</a> <a href="/tags/ECMAScript-JavaScript/" style="font-size: 10px;">ECMAScript(JavaScript)</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Layout/" style="font-size: 10px;">Layout</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIME-Type/" style="font-size: 10px;">MIME Type</a> <a href="/tags/Nginx/" style="font-size: 20px;">Nginx</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/T-T/" style="font-size: 10px;">T&T</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/systemctl/" style="font-size: 10px;">systemctl</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/07/systemctl命令/">systemctl命令</a>
          </li>
        
          <li>
            <a href="/2019/06/20/改变/">改变</a>
          </li>
        
          <li>
            <a href="/2019/05/08/Git/">Git</a>
          </li>
        
          <li>
            <a href="/2019/05/07/常用布局/">常用布局</a>
          </li>
        
          <li>
            <a href="/2019/05/06/TCP/">TCP</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Jarry Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>