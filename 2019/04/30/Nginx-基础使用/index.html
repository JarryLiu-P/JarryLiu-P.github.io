<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Nginx-基础使用 | THAT-WHAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。常用场景 静态资源服务器 代理服务 跨站资源访问 适配PC与移动端环境 负载均衡调度 缓存服务 简单的访问控制 图片处理  默认配置文件全局块：nginx 全局配置。比如用户以及用户组 user，nginx 进程 pid 文件存放路径，日志存放路径 error_log，工作">
<meta name="keywords" content="Nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx-基础使用">
<meta property="og:url" content="https://jarryliu-p.github.io/2019/04/30/Nginx-基础使用/index.html">
<meta property="og:site_name" content="THAT-WHAT">
<meta property="og:description" content="Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。常用场景 静态资源服务器 代理服务 跨站资源访问 适配PC与移动端环境 负载均衡调度 缓存服务 简单的访问控制 图片处理  默认配置文件全局块：nginx 全局配置。比如用户以及用户组 user，nginx 进程 pid 文件存放路径，日志存放路径 error_log，工作">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-06-20T10:03:27.077Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx-基础使用">
<meta name="twitter:description" content="Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。常用场景 静态资源服务器 代理服务 跨站资源访问 适配PC与移动端环境 负载均衡调度 缓存服务 简单的访问控制 图片处理  默认配置文件全局块：nginx 全局配置。比如用户以及用户组 user，nginx 进程 pid 文件存放路径，日志存放路径 error_log，工作">
  
    <link rel="alternate" href="/atom.xml" title="THAT-WHAT" type="application/atom+xml">
  
  
    <link rel="icon" href="css/images/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">THAT-WHAT</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Nginx-基础使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/30/Nginx-基础使用/" class="article-date">
  <time datetime="2019-04-30T03:19:54.000Z" itemprop="datePublished">2019-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nginx-基础使用
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Nginx-engine-x-是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP-POP3-SMTP服务。"><a href="#Nginx-engine-x-是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP-POP3-SMTP服务。" class="headerlink" title="Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。"></a><code>Nginx</code> (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。</h3><h4 id="常用场景"><a href="#常用场景" class="headerlink" title="常用场景"></a>常用场景</h4><ul>
<li><a href="#1">静态资源服务器</a></li>
<li><a href="#2">代理服务</a></li>
<li><a href="#3">跨站资源访问</a></li>
<li><a href="#4">适配PC与移动端环境</a></li>
<li><a href="#5">负载均衡调度</a></li>
<li><a href="#6">缓存服务</a></li>
<li><a href="#7">简单的访问控制</a></li>
<li><a href="#8">图片处理</a></li>
</ul>
<h4 id="默认配置文件"><a href="#默认配置文件" class="headerlink" title="默认配置文件"></a>默认配置文件</h4><p>全局块：<code>nginx</code> 全局配置。比如用户以及用户组 <code>user</code>，<code>nginx</code> 进程 <code>pid</code> 文件存放路径，日志存放路径 <code>error_log</code>，工作进程<code>worker process</code> 数等，也可以引入配置文件。</p>
<p><code>events</code> 块：服务器连接相关配置。比如进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</p>
<p><code>http</code> 块：可嵌套多个虚拟主机 <code>server</code>，配置代理，设置缓存，配置日志定义等。支持很多第三方模块的配置。比如文件引入，<code>mime-type</code> 定义，图片压缩，日志自定义，传输文件配置，设置连接超时时间，单个连接请求数等等。</p>
<p><code>server</code> 块：虚拟主机的相关配置。</p>
<p><code>location</code> 块：请求的路由相关配置，特殊页面的处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"># &#123;全局块&#125;</span><br><span class="line"></span><br><span class="line"># 设置用户组</span><br><span class="line">#user  nobody;</span><br><span class="line"># 配置用户或者组，默认为nobody nobody。</span><br><span class="line">#user admin admin;  </span><br><span class="line"></span><br><span class="line"># 设置工作进程的数量</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"># 指定日志路径，日志级别包括 debug | info | notice | warn | error | alert 等</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"># 指定进程文件</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123; # &#123;event块&#125;</span><br><span class="line">    # 设置一个进程是否同时接受多个网络连接，默认为off</span><br><span class="line">    #multi_accept on;</span><br><span class="line">    # 事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class="line">    #use epoll;</span><br><span class="line">    # 进程的最大连接数</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123; &#123;#http块&#125;</span><br><span class="line">    # 文件拓展名查找集合</span><br><span class="line">    include       mime.types;</span><br><span class="line">    # 默认文件类型为文件流，匹配.*</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 日志格式定义，main为日志别名</span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    # 取消服务日志</span><br><span class="line">    #access_log off;</span><br><span class="line">    # 指定日志输入文件</span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    # 调用 sendfile 系统传输文件，sendfile on 表示通过文件描述符直接拷贝，而不是用read()/write()</span><br><span class="line">    sendfile        on;</span><br><span class="line">    # tcp_nopush = on 会设置调用tcp_cork方法，这个也是默认的，结果就是数据包不会马上传送出去，等到数据包最大时，一次性的传输出去，这样有助于解决网络堵塞。</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    # 设置连接超时时间</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    # 是否启用 gzip 压缩，需要浏览器支持，需要解压缩</span><br><span class="line">    #gzip  on;</span><br><span class="line">    # 设置gzip所需的http协议最低版本 （HTTP/1.1, HTTP/1.0）</span><br><span class="line">    #gzip_http_version 1.1;</span><br><span class="line">    # 设置压缩级别，压缩级别越高压缩时间越长  （1-9）</span><br><span class="line">    #gzip_comp_level 4;</span><br><span class="line">    # 设置压缩的最小字节数， 页面Content-Length获取</span><br><span class="line">    #gzip_min_length 1000;</span><br><span class="line">    # 设置压缩文件的类型</span><br><span class="line">    #gzip_types text/plain application/javascript text/css;</span><br><span class="line"></span><br><span class="line">    server &#123; #&#123;server块&#125;</span><br><span class="line">        # 监听端口</span><br><span class="line">        listen       80;</span><br><span class="line">        # 虚拟主机名称</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        # 设置编码字符集</span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        # 指定日志输入文件</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        # 监听请求路由</span><br><span class="line">        location / &#123; #&#123;location块&#125;</span><br><span class="line">            # 查找根目录</span><br><span class="line">            root   html;</span><br><span class="line">            # 默认匹配</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        # 重定位服务器错误到静态页面 /50x.html</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">        # concurs with nginx&apos;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="nginx-内置变量"><a href="#nginx-内置变量" class="headerlink" title="nginx 内置变量"></a><code>nginx</code> 内置变量</h3><ul>
<li>$args ： #这个变量等于请求行中的参数，同 <code>$query_string</code></li>
<li>$content_length ： 请求头中的 <code>Content-length</code> 字段。</li>
<li>$content_type ： 请求头中的 <code>Content-Type</code> 字段。</li>
<li>$document_root ： 当前请求在 <code>root</code> 指令中指定的值。</li>
<li>$host ： 请求主机头字段，否则为服务器名称。</li>
<li>$http_user_agent ： 客户端 <code>agent</code> 信息</li>
<li>$http_cookie ： 客户端 <code>cookie</code> 信息</li>
<li>$limit_rate ： 这个变量可以限制连接速率。</li>
<li>$request_method ： 客户端请求的动作，通常为 <code>GET</code> 或 <code>POST</code>。</li>
<li>$remote_addr ： 客户端的 <code>IP</code> 地址。</li>
<li>$remote_port ： 客户端的端口。</li>
<li>$remote_user ： 已经经过 <code>Auth Basic Module</code> 验证的用户名。</li>
<li>$request_filename ： 当前请求的文件路径，由 <code>root</code> 或 <code>alias</code> 指令与 <code>URI</code> 请求生成。</li>
<li>$scheme ： <code>HTTP</code> 方法（如 <code>http</code> ，<code>https</code>）。</li>
<li>$server_protocol ： 请求使用的协议，通常是 <code>HTTP/1.0</code> 或 <code>HTTP/1.1</code>。</li>
<li>$server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。</li>
<li>$server_name ： 服务器名称。</li>
<li>$server_port ： 请求到达服务器的端口号。</li>
<li>$request_uri ： 包含请求参数的原始 <code>URI</code>，不包含主机名，如：”/foo/bar.php?arg=baz”。</li>
<li>$uri ： 不带请求参数的当前 <code>URI</code>，<code>$uri</code> 不包含主机名，如”/foo/bar.html”。</li>
<li>$document_uri ： 与 <code>$uri</code> 相同</li>
</ul>
<h3 id="nginx-基本命令"><a href="#nginx-基本命令" class="headerlink" title="nginx 基本命令"></a><code>nginx</code> 基本命令</h3><ul>
<li>nginx -t 检查配置文件是否有语法错误</li>
<li>nginx -s reload 向主进程发送信号，重新加载配置文件</li>
<li>nginx -s stop 快速关闭</li>
<li>nginx -s quit 等待工作进程处理完成后关闭</li>
</ul>
<h3 id="location-匹配规则（优先级递减）"><a href="#location-匹配规则（优先级递减）" class="headerlink" title="location 匹配规则（优先级递减）"></a><code>location</code> 匹配规则（优先级递减）</h3><table>
<thead>
<tr>
<th style="text-align:right">匹配符</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">=</td>
<td style="text-align:left">进行普通字符精确匹配。也就是完全匹配</td>
</tr>
<tr>
<td style="text-align:right">^~</td>
<td style="text-align:left">前缀匹配。如果匹配成功，则不再匹配其他location</td>
</tr>
</tbody>
</table>
<p>v~|表示执行一个正则匹配，区分大小写|<br>|~*|表示执行一个正则匹配，不区分大小写|<br>|/xxx/|常规字符串路径匹配|<br>|/|通用匹配，任何请求都会匹配到|</p>
<h4 id="静态资源服务器"><a href="#静态资源服务器" class="headerlink" title="静态资源服务器"></a><span id="1">静态资源服务器<span></span></span></h4><p>常见的静态资源包括图片，文档，视频等文件，所以 <code>nginx</code> 常用来作为静态网站服务器，或者作为 <code>cdn</code> 资源服务器。<br>例如以下是一个前后端分离的工程的前端工程部署配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen  8080;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    root html/project;</span><br><span class="line">    location / &#123;</span><br><span class="line">        // 按照优先级 &apos;$uri&apos; &gt; &apos;$uri/&apos; &gt; &apos;/index.html&apos; &gt; &apos;=404&apos;依次匹配</span><br><span class="line">        try_files $uri $uri/ /index.html =404;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="代理服务"><a href="#代理服务" class="headerlink" title="代理服务"></a><span id="2">代理服务<span></span></span></h4><p><code>nginx</code> 用作代理服务器可以作为正向代理或者反向代理，而反向代理正是跨站资源访问的解决方案之一。<br>如下是正向代理配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen  8080;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    # DNS 域名解析服务器</span><br><span class="line">    resolver 8.8.8.8;</span><br><span class="line">    # 解析超时时间</span><br><span class="line">    resolver_timeout 5s;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass   $scheme://$http_host/$request_uri;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line"></span><br><span class="line">        proxy_buffers 256 4k;</span><br><span class="line">        proxy_max_temp_file_size 0;</span><br><span class="line"></span><br><span class="line">        proxy_connect_timeout 30;</span><br><span class="line"></span><br><span class="line">        proxy_cache_valid 200 302 10m;</span><br><span class="line">        proxy_cache_valid 301 1h;</span><br><span class="line">        proxy_cache_valid any 1m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一次代理，直接在shell执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy=http://x.x.x.x:8080</span><br></pre></td></tr></table></figure></p>
<p>永久使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line">export http_proxy=http://x.x.x.x:8080</span><br><span class="line">source .bashrc # 刷新以加载变量</span><br></pre></td></tr></table></figure></p>
<h4 id="跨站资源访问"><a href="#跨站资源访问" class="headerlink" title="跨站资源访问"></a><span id="3">跨站资源访问<span></span></span></h4><p>反向代理配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location /api &#123;</span><br><span class="line">        # 代理转发</span><br><span class="line">        proxy_pass http://localhost:8081;</span><br><span class="line">        # 路径重写（如果需要）</span><br><span class="line">        # rewrite  /api/(.*)  /$1  break;</span><br><span class="line"></span><br><span class="line">        # 请求host传给后端</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        # 设置用户ip地址</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line"></span><br><span class="line">        proxy_buffers 256 4k;</span><br><span class="line">        proxy_max_temp_file_size 0;</span><br><span class="line"></span><br><span class="line">        # 代理超时时间</span><br><span class="line">        proxy_connect_timeout 30;</span><br><span class="line"></span><br><span class="line">        # 当请求服务器出错去寻找其他服务器</span><br><span class="line">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="适配PC与移动端环境"><a href="#适配PC与移动端环境" class="headerlink" title="适配PC与移动端环境"></a><span id="4">适配PC与移动端环境<span></span></span></h4><p><code>nginx</code> 可以通过内置变量 <code>$http_user_agent</code>，获取到请求客户端的 <code>userAgent</code>，从而知道用户处于移动端还是PC，进而控制重定向到H5站还是PC站。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 移动、pc设备适配</span><br><span class="line">        if ($http_user_agent ~* &apos;(Android|webOS|iPhone|iPod|BlackBerry)&apos;) &#123;</span><br><span class="line">            set $mobile_request &apos;1&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($mobile_request = &apos;1&apos;) &#123;</span><br><span class="line">            rewrite ^.+ http://mysite-base-H5.com;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="负载均衡调度"><a href="#负载均衡调度" class="headerlink" title="负载均衡调度"></a><span id="5">负载均衡调度<span></span></span></h4><p>RR（round robin：轮询）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    upstream web_servers &#123;  </span><br><span class="line">        server localhost:8081;  </span><br><span class="line">        server localhost:8082;  </span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        ...</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://web_servers;</span><br><span class="line">            # 必须指定Header Host</span><br><span class="line">            proxy_set_header Host $host:$server_port;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按权重分配<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    server localhost:8081 weight=1;</span><br><span class="line">    server localhost:8082 weight=3;</span><br><span class="line">    server localhost:8083 weight=4 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按地址分配：ip_hash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream test &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>后端服务器的响应时间来分配：fair(第三方)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    fair;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按访问url的hash结果来分配：url_hash(第三方)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    hash $request_uri;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="缓存服务"><a href="#缓存服务" class="headerlink" title="缓存服务"></a><span id="6">缓存服务<span></span></span></h4><p>对扩展名为 <code>gif</code>，<code>jpg</code>，<code>jpeg</code>，<code>png</code>，<code>bmp</code>，<code>swf</code>，<code>js</code>，<code>css</code> 的图片，<code>flash</code>，<code>javascript</code>，<code>css</code> 文件开启 <code>Web</code> 缓存,其他文件不缓存。配置文件如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">user  www;</span><br><span class="line">worker_processes  8;</span><br><span class="line">  </span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  65535;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    charset utf-8;</span><br><span class="line"> </span><br><span class="line">    log_format  main  &apos;$http_x_forwarded_for $remote_addr $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_cookie&quot; $host $request_time&apos;;</span><br><span class="line">    sendfile       on;</span><br><span class="line">    tcp_nopush     on;</span><br><span class="line">    tcp_nodelay    on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"> </span><br><span class="line">    #要想开启nginx的缓存功能，需要添加此处的两行内容！</span><br><span class="line">    #设置Web缓存区名称为cache_one,内存缓存空间大小为500M,缓存的数据超过1天没有被访问就自动清除;访问的缓存数据,硬盘缓存空间大小为30G</span><br><span class="line">    proxy_cache_path /usr/local/nginx/proxy_cache_path levels=1:2 keys_zone=cache_one:500m inactive=1d max_size=30g;</span><br><span class="line"> </span><br><span class="line">    #创建缓存的时候可能生成一些临时文件存放的位置</span><br><span class="line">    proxy_temp_path /usr/local/nginx/proxy_temp_path;</span><br><span class="line"> </span><br><span class="line">    fastcgi_connect_timeout 3000;</span><br><span class="line">    fastcgi_send_timeout 3000;</span><br><span class="line">    fastcgi_read_timeout 3000;</span><br><span class="line">    fastcgi_buffer_size 256k;</span><br><span class="line">    fastcgi_buffers 8 256k;</span><br><span class="line">    fastcgi_busy_buffers_size 256k;</span><br><span class="line">    fastcgi_temp_file_write_size 256k;</span><br><span class="line">    fastcgi_intercept_errors on;</span><br><span class="line">  </span><br><span class="line">     </span><br><span class="line">    client_header_timeout 600s;</span><br><span class="line">    client_body_timeout 600s;</span><br><span class="line">  </span><br><span class="line">    client_max_body_size 100m;             </span><br><span class="line">    client_body_buffer_size 256k;           </span><br><span class="line">  </span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_min_length  1k;</span><br><span class="line">    gzip_buffers     4 16k;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_comp_level 9;</span><br><span class="line">    gzip_types       text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">    upstream LB-WWW &#123;</span><br><span class="line">      ip_hash;</span><br><span class="line">      server 192.168.1.101:80 max_fails=3 fail_timeout=30s;     #max_fails = 3 为允许失败的次数，默认值为1</span><br><span class="line">      server 192.168.1.102:80 max_fails=3 fail_timeout=30s;     #fail_timeout = 30s 当max_fails次失败后，暂停将请求分发到该后端服务器的时间</span><br><span class="line">      server 192.168.1.118:80 max_fails=3 fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.wangshibo.com;</span><br><span class="line">        index index.html index.php index.htm;</span><br><span class="line">        root /var/www/html;</span><br><span class="line">    </span><br><span class="line">        access_log  /usr/local/nginx/logs/www-access.log main;</span><br><span class="line">        error_log  /usr/local/nginx/logs/www-error.log;</span><br><span class="line">    </span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://LB-WWW;</span><br><span class="line">            proxy_redirect off ;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            #跟后端服务器连接超时时间，发起握手等候响应时间</span><br><span class="line">            proxy_connect_timeout 300;</span><br><span class="line">            #后端服务器回传时间，就是在规定时间内后端服务器必须传完所有数据</span><br><span class="line">            proxy_send_timeout 300;</span><br><span class="line">            #连接成功后等待后端服务器的响应时间，已经进入后端的排队之中等候处理</span><br><span class="line">            proxy_read_timeout 600;</span><br><span class="line">            #代理请求缓冲区,会保存用户的头信息以供nginx进行处理</span><br><span class="line">            proxy_buffer_size 256k;</span><br><span class="line">            #同上，告诉nginx保存单个用几个buffer最大用多少空间</span><br><span class="line">            proxy_buffers 4 256k;</span><br><span class="line">            #如果系统很忙时候可以申请最大的proxy_buffers</span><br><span class="line">            proxy_busy_buffers_size 256k;</span><br><span class="line">            #proxy缓存临时文件的大小</span><br><span class="line">            proxy_temp_file_write_size 256k;</span><br><span class="line">            proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;</span><br><span class="line">            proxy_max_temp_file_size 128m;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css)$ &#123;         </span><br><span class="line">            #使用Web缓存区cache_one，已在nginx.conf的缓存配置中命名的。</span><br><span class="line">            proxy_cache cache_one ;</span><br><span class="line">            #对不同HTTP状态码缓存设置不同的缓存时间</span><br><span class="line">            proxy_cache_valid 200 304 12h ;</span><br><span class="line">            proxy_cache_valid 301 302 1m ;</span><br><span class="line">            proxy_cache_valid any 1m ;</span><br><span class="line">            #设置Web缓存的Key值,Nginx根据Key值md5哈希存储缓存,这里根据&quot;域名,URI,</span><br><span class="line">            #参数&quot;组合成Key</span><br><span class="line">            proxy_cache_key $host$uri$is_args$args;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        #用于清除缓存的url设置</span><br><span class="line">        #假设一个URL为http://www.wangshibo.com/test.gif,那么就可以通过访问http://www.wangshibo.com/purge/test.gif清除该URL的缓存。</span><br><span class="line">        location ~ /purge(/.*) &#123;</span><br><span class="line">            #设置只允许指定的IP或IP段才可以清除URL缓存</span><br><span class="line">            allow 127.0.0.1 ;</span><br><span class="line">            allow 192.168.0.0/16 ;</span><br><span class="line">            deny all ;</span><br><span class="line">            proxy_cache_purge cache_one $host$1$is_args$args ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="简单的访问控制"><a href="#简单的访问控制" class="headerlink" title="简单的访问控制"></a><span id="7">简单的访问控制<span></span></span></h4><p><code>deny</code> 和 <code>allow</code> 是 <code>ngx_http_access_module</code> 模块（已内置）中的语法。采用的是从上到下匹配方式，匹配到就跳出不再继续匹配。上述配置的意思就是，首先禁止 <code>192.168.1.100</code> 访问，然后允许 <code>192.168.1.10-200</code> ip段内的访问（排除 <code>192.168.1.100</code>），同时允许 <code>10.110.50.16</code> 这个单独ip的访问，剩下未匹配到的全部禁止访问。实际生产中，经常和 <code>ngx_http_geo_module</code> 模块（可以更好地管理ip地址表，已内置）配合使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location / &#123;</span><br><span class="line">        deny  192.168.1.100;</span><br><span class="line">        allow 192.168.1.10/200;</span><br><span class="line">        allow 10.110.50.16;</span><br><span class="line">        deny  all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a><span id="8">图片处理<span></span></span></h4><p>满足日常对图片的裁剪/缩放/旋转/图片品质等处理需求。要用到 <code>ngx_http_image_filter_module</code> 模块。这个模块是非基本模块，需要安装。 下面是图片缩放功能部分的 <code>nginx</code> 配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    # 图片缩放处理</span><br><span class="line">    # 这里约定的图片处理url格式：以 mysite-base.com/img/路径访问</span><br><span class="line">    location ~* /img/(.+)$ &#123;</span><br><span class="line">        #图片服务端储存地址</span><br><span class="line">        alias /Users/cc/Desktop/server/static/image/$1;</span><br><span class="line">        #图片宽度默认值</span><br><span class="line">        set $width -;</span><br><span class="line">        #图片高度默认值</span><br><span class="line">        set $height -;</span><br><span class="line">        if ($arg_width != &quot;&quot;) &#123;</span><br><span class="line">            set $width $arg_width;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($arg_height != &quot;&quot;) &#123;</span><br><span class="line">            set $height $arg_height;</span><br><span class="line">        &#125;</span><br><span class="line">        #设置图片宽高</span><br><span class="line">        image_filter resize $width $height;</span><br><span class="line">        #设置Nginx读取图片的最大buffer</span><br><span class="line">        image_filter_buffer 10M;</span><br><span class="line">        #是否开启图片图像隔行扫描</span><br><span class="line">        image_filter_interlace on;</span><br><span class="line">        #图片处理错误提示图，例如缩放参数不是数字</span><br><span class="line">        error_page 415 = 415.png; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="参考网站以及文章"><a href="#参考网站以及文章" class="headerlink" title="参考网站以及文章"></a>参考网站以及文章</h3><p><a href="https://nginx.org/" target="_blank" rel="noopener">nginx官网</a></p>
<p><a href="https://juejin.im/post/5bacbd395188255c8d0fd4b2" target="_blank" rel="noopener">Nginx与前端开发</a></p>
<p><a href="https://juejin.im/post/5cae9de95188251ae2324ec3" target="_blank" rel="noopener">前端想要了解的Nginx</a></p>
<p><a href="https://www.jianshu.com/p/577d022f5693" target="_blank" rel="noopener">Nginx常见使用场景-WEB服务(四)</a></p>
<p><a href="https://blog.csdn.net/vbirdbest/article/details/80913319" target="_blank" rel="noopener">nginx应用场景</a></p>
<p><a href="https://www.cnblogs.com/zhang-shijie/p/5498623.html" target="_blank" rel="noopener">Nginx 之六： Nginx服务器的正向及反向代理功能</a></p>
<p><a href="https://www.cnblogs.com/cuishuai/p/8073748.html" target="_blank" rel="noopener">nginx之正向代理</a></p>
<p><a href="https://www.cnblogs.com/kevingrace/p/6198287.html" target="_blank" rel="noopener">nginx的web缓存服务环境部署记录</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jarryliu-p.github.io/2019/04/30/Nginx-基础使用/" data-id="cjx4kciwa000xwwv515qejj6u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/04/30/Nginx-默认mimetype集合/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Nginx-默认mimetype集合
        
      </div>
    </a>
  
  
    <a href="/2019/04/30/TypeScript-基本类型/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">TypeScript-基本类型</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code-Review/">Code Review</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-JavaScript/">ECMAScript(JavaScript)</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Layout/">Layout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIME-Type/">MIME Type</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/">SSH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/T-T/">T&T</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Code-Review/" style="font-size: 10px;">Code Review</a> <a href="/tags/ECMAScript-JavaScript/" style="font-size: 10px;">ECMAScript(JavaScript)</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Layout/" style="font-size: 10px;">Layout</a> <a href="/tags/MIME-Type/" style="font-size: 10px;">MIME Type</a> <a href="/tags/Nginx/" style="font-size: 20px;">Nginx</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/T-T/" style="font-size: 10px;">T&T</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/20/改变/">改变</a>
          </li>
        
          <li>
            <a href="/2019/05/08/Git/">Git</a>
          </li>
        
          <li>
            <a href="/2019/05/07/常用布局/">常用布局</a>
          </li>
        
          <li>
            <a href="/2019/05/06/TCP/">TCP</a>
          </li>
        
          <li>
            <a href="/2019/05/05/前端常用代码示例-1/">前端常用代码示例-1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Jarry Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>